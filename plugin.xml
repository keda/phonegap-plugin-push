<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<plugin xmlns="http://www.phonegap.com/ns/plugins/1.0" xmlns:android="http://schemas.android.com/apk/res/android"
        xmlns:amazon="http://schemas.android.com/apk/lib/com.amazon.device.ads"
        xmlns:rim="http://www.blackberry.com/ns/widgets" id="phonegap-plugin-push" version="1.8.4">
    <name>PushPlugin</name>
    <description>
        This plugin allows your application to receive push notifications on Android, iOS and Windows devices.
        Android uses Google Cloud Messaging.
        iOS uses Apple APNS Notifications.
        Windows uses Microsoft WNS Notifications.
    </description>
    <license>MIT</license>
    <js-module src="www/push.js" name="PushNotification">
        <clobbers target="PushNotification"/>
    </js-module>
    <engines>
        <engine name="cordova" version=">=3.6.3"/>
        <engine name="cordova-android" version=">=4.0.0"/>
        <engine name="cordova-ios" version=">=4.1.0"/>
    </engines>
    <preference name="SENDER_ID"/>
    <platform name="android">
        <config-file target="res/xml/config.xml" parent="/*">
            <feature name="PushNotification">
                <param name="android-package" value="com.desinton.push.PushPlugin"/>
            </feature>
        </config-file>
        <config-file target="res/values/strings.xml" parent="/resources">
            <string name="google_app_id">$SENDER_ID</string>
        </config-file>
        <config-file target="AndroidManifest.xml" parent="/manifest">
            <!-- Push service 运行需要的权限 -->
            <uses-permission android:name="android.permission.INTERNET"/>
            <uses-permission android:name="android.permission.READ_PHONE_STATE"/>
            <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>
            <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"/>
            <uses-permission android:name="android.permission.WRITE_SETTINGS"/>
            <uses-permission android:name="android.permission.VIBRATE"/>
            <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
            <uses-permission android:name="android.permission.DISABLE_KEYGUARD"/>
            <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>
            <uses-permission android:name="android.permission.ACCESS_WIFI_STATE"/>
            <!-- 富媒体需要声明的权限 -->
            <uses-permission android:name="android.permission.ACCESS_DOWNLOAD_MANAGER"/>
            <uses-permission android:name="android.permission.DOWNLOAD_WITHOUT_NOTIFICATION"/>
            <uses-permission android:name="android.permission.EXPAND_STATUS_BAR"/>

            <!-- 适配Android N系统必需的ContentProvider写权限声明，写权限包含应用包名-->
            <uses-permission android:name="baidu.push.permission.WRITE_PUSHINFOPROVIDER.com.desinton" />
            <permission
                android:name="baidu.push.permission.WRITE_PUSHINFOPROVIDER.com.desinton"
                android:protectionLevel="normal">
            </permission>

        </config-file>
        <config-file target="AndroidManifest.xml" parent="/manifest/application">
            <!-- push service start -->
            <!-- 用于接收系统消息以保证PushService正常运行 -->
            <receiver android:name="com.baidu.android.pushservice.PushServiceReceiver" android:process=":bdservice_v1">
                <intent-filter>
                    <action android:name="android.intent.action.BOOT_COMPLETED"/>
                    <action android:name="android.net.conn.CONNECTIVITY_CHANGE"/>
                    <action android:name="com.baidu.android.pushservice.action.notification.SHOW"/>
                    <action android:name="com.baidu.android.pushservice.action.media.CLICK"/>
                    <!-- 以下四项为可选的action声明，可大大提高service存活率和消息到达速度 -->
                    <action android:name="android.intent.action.MEDIA_MOUNTED"/>
                    <action android:name="android.intent.action.USER_PRESENT"/>
                    <action android:name="android.intent.action.ACTION_POWER_CONNECTED"/>
                    <action android:name="android.intent.action.ACTION_POWER_DISCONNECTED"/>
                </intent-filter>
            </receiver>

            <!-- Push服务接收客户端发送的各种请求-->
            <receiver android:name="com.baidu.android.pushservice.RegistrationReceiver" android:process=":bdservice_v1">
                <intent-filter>
                    <action android:name="com.baidu.android.pushservice.action.METHOD"/>
                    <action android:name="com.baidu.android.pushservice.action.BIND_SYNC"/>
                </intent-filter>
                <intent-filter>
                    <action android:name="android.intent.action.PACKAGE_REMOVED"/>
                    <data android:scheme="package"/>
                </intent-filter>
            </receiver>

            <!-- push应用定义消息receiver声明 -->
            <receiver android:name="com.desinton.push.MyPushMessageReceiver" >
                <intent-filter>
                    <!-- 接收push消息 -->
                    <action android:name="com.baidu.android.pushservice.action.MESSAGE" />
                    <!-- 接收bind,unbind,fetch,delete等反馈消息 -->
                    <action android:name="com.baidu.android.pushservice.action.RECEIVE" />
                    <action android:name="com.baidu.android.pushservice.action.notification.CLICK" />
                </intent-filter>
            </receiver>

            <service android:name="com.baidu.android.pushservice.PushService" android:exported="true"
                     android:process=":bdservice_v1">
                <intent-filter>
                    <action android:name="com.baidu.android.pushservice.action.PUSH_SERVICE"/>
                </intent-filter>
            </service>
            <!-- 4.4版本新增的CommandService声明，提升小米和魅族手机上的实际推送到达率 -->
            <service android:name="com.baidu.android.pushservice.CommandService" android:exported="true"/>
            <!-- push结束 -->

        </config-file>
        <framework src="push.gradle" custom="true" type="gradleReference"/>
        <framework src="com.android.support:support-v13:23+"/>
        <framework src="com.google.android.gms:play-services-gcm:9.8+"/>
        <framework src="me.leolin:ShortcutBadger:1.1.4@aar"/>

        <source-file src="src/android/libs/pushservice-5.2.0.12.jar" target-dir="src/android/libs"/>

        <source-file src="src/android/com/desinton/push/MyPushMessageReceiver.java" target-dir="src/com/desinton/push/"/>
    </platform>
    <platform name="browser">
        <js-module src="www/browser/push.js" name="BrowserPush">
            <clobbers target="PushNotification"/>
        </js-module>
        <asset src="src/browser/ServiceWorker.js" target="ServiceWorker.js"/>
        <asset src="src/browser/manifest.json" target="manifest.json"/>
    </platform>
    <platform name="ios">
        <config-file target="config.xml" parent="/*">
            <feature name="PushNotification">
                <param name="ios-package" value="PushPlugin"/>
            </feature>
        </config-file>
        <config-file target="*-Info.plist" parent="UIBackgroundModes">
            <array>
                <string>remote-notification</string>
            </array>
        </config-file>
        <config-file target="*-Info.plist" parent="GCM_SENDER_ID">
            <string>$SENDER_ID</string>
        </config-file>
        <config-file target="*-Info.plist" parent="IS_GCM_ENABLED">
            <true/>
        </config-file>
        <source-file src="src/ios/AppDelegate+notification.m"/>
        <source-file src="src/ios/PushPlugin.m"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/Google/Libraries/libGGLCloudMessaging.a" framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/Google/Libraries/libGGLCore.a" framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GGLInstanceID/Libraries/libGGLInstanceIDLib.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleIPhoneUtilities/Libraries/libGIP_Reachability.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleSymbolUtilities/Libraries/libGSDK_Overload.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries"
                     src="src/ios/GoogleNetworkingUtilities/Libraries/libGTMSessionFetcher_core.a" framework="true"/>
        <source-file target-dir="GCM/Libraries"
                     src="src/ios/GoogleNetworkingUtilities/Libraries/libGTMSessionFetcher_full.a" framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTMStackTrace.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_AddressBook.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_DebugUtils.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_GTMURLBuilder.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_KVO.a" framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_NSData+zlib.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries"
                     src="src/ios/GoogleUtilities/Libraries/libGTM_NSDictionary+URLArguments.a" framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_NSScannerJSON.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_NSStringHTML.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_NSStringXML.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_Regex.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_RoundedRectPath.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_StringEncoding.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_SystemVersion.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_UIFont+LineHeight.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_core.a" framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleUtilities/Libraries/libGTM_iPhone.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleCloudMessaging/Libraries/libGcmLib.a"
                     framework="true"/>
        <source-file target-dir="GCM/Libraries" src="src/ios/GoogleInterchangeUtilities/Libraries/libProtocolBuffers.a"
                     framework="true"/>
        <header-file src="src/ios/AppDelegate+notification.h"/>
        <header-file src="src/ios/PushPlugin.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/GGLInstanceID/Headers/Public/GGLInstanceID.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/GGLInstanceID/Headers/Public/GGLInstanceIDConfig.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/GGLInstanceID/Headers/Public/GGLInstanceIDDelegate.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/GGLInstanceID/Headers/Public/GGLInstanceIDHeaders.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/Google/Headers/GGLCloudMessaging/Public/CloudMessaging.h"/>
        <header-file target-dir="GCM/Headers"
                     src="src/ios/Google/Headers/GGLCloudMessaging/Public/GGLContext+CloudMessaging.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/Google/Headers/GGLCore/Public/Core.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/Google/Headers/GGLCore/Public/GGLConfiguration.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/Google/Headers/GGLCore/Public/GGLContext.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/Google/Headers/GGLCore/Public/GGLErrorCode.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/GoogleCloudMessaging/Headers/Public/GCMConfig.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/GoogleCloudMessaging/Headers/Public/GCMPubSub.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/GoogleCloudMessaging/Headers/Public/GCMReceiverDelegate.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/GoogleCloudMessaging/Headers/Public/GCMService.h"/>
        <header-file target-dir="GCM/Headers" src="src/ios/GoogleCloudMessaging/Headers/Public/GoogleCloudMessaging.h"/>
        <framework src="AddressBook.framework"/>
        <framework src="libsqlite3.tbd"/>
        <framework src="libz.tbd"/>
    </platform>
    <platform name="windows">
        <hook type="after_plugin_install" src="hooks/windows/setToastCapable.js"/>
        <js-module src="src/windows/PushPluginProxy.js" name="PushPlugin">
            <merges target=""/>
        </js-module>
        <config-file target="config.xml" parent="/*">
            <preference name="WindowsToastCapable" value="true"/>
        </config-file>
    </platform>
</plugin>
